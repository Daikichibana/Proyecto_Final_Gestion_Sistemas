@*@using Compartido
@using Compartido.Dto.Distribuidora.General
@inject IInventarioServices _inventarioService
@inject ILocalStorageService LocalStorage

<h3>Registrar Producto</h3>

<!-- Formulario Registro -->
<div style="display: flex; justify-content: center;">
    <form style="width: 70%;">
        <!-- Informacion del responsable -->

        <fieldset class="form-group">
             <div class="form-group">
                <label for="nombre" class="form-label mt-4">Nombre</label>
                <input @bind=Producto.Nombre type="text" class="form-control" id="nombre" placeholder="Ingrese nombre del producto.">
            </div>
            <div class="form-group">
                <label for="NombreRubro" class="form-label mt-4">Tipo producto</label>
                <select @bind=Producto.TipoProductoId class="form-select" id="rubroNegocio">
                    @foreach (TipoProductoDTO tipoProducto in ListaTipoProducto)
                    {
                        @if (tipoProducto.Id == Producto.TipoProductoId)
                        {
                            <option value=@tipoProducto.Id selected="selected">@tipoProducto.Nombre</option>
                        }
                        else
                        {
                            <option value=@tipoProducto.Id>@tipoProducto.Nombre</option>
                        }
                    }
                </select>
            </div>
            <div class="form-group">
                <label for="Descripcion" class="form-label mt-4">Descripcion</label>
                <input @bind=Producto.Descripcion type="text" class="form-control" id="Descripcion" placeholder="Ingrese descripcion.">
            </div>
        </fieldset>
    </form>
</div>

<!-- Boton enviar -->

<div style="display: flex; justify-content: center; align-items: center; height: 250px;">
    <button @onclick="@(() => MostrarListado.InvokeAsync())" type="submit" class="btn btn-primary" id="btnVolver" style="font-size: 20px; margin-right: 20px">Volver atras</button>
    <button @onclick=Registrar type="submit" class="btn btn-primary" id="enviarFormulario" style="font-size: 20px;">Registrar</button>
</div>


@code {
    [Parameter]
    public EventCallback<bool> MostrarRegistrar { get; set; }

    [Parameter]
    public EventCallback<bool> MostrarListado { get; set; }

      [Parameter]
    public List<TipoProductoDTO> ListaTipoProducto { get; set; }

    public ServiceResponse<ProductoDTO> ResponseProducto { get; set; }

    public ProductoDTO Producto { get; set; }

    public string Distribuidora { get; set; }


    protected override void OnInitialized()
    {
        Producto =  new ProductoDTO();
    }

    protected override async Task OnInitializedAsync()
    {
        Distribuidora = await LocalStorage.GetItemAsync<string>("idEmpresa");
        StateHasChanged();
    }


    public async void Registrar()
    {
        Guid dist = new Guid(Distribuidora);
        Producto.EmpresaDistribuidoraId = dist;
        ResponseProducto = await _inventarioService.CrearProducto(Producto);
        
        if(ResponseProducto.Success)
            await this.MostrarListado.InvokeAsync();
    }
}*@